---
# Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "Quick Start"
---

<p>
This guide describes how to install and run Vespa on a single machine using Docker. Once you have completed
the steps in this guide, you have a running Vespa instance with searchable documents in it and will have run
some search queries against them.</p>
<p>Also try the <a href="vespa-quick-start-centos.html">CentOS / Vagrant</a> or
<a href="vespa-quick-start-windows.html">Windows</a> guide.
</p><p>
<strong>Prerequisites</strong>:
<ul>
	<li><a href="https://docs.docker.com/engine/installation/">Docker</a> installed.</li>
	<li><a href="https://git-scm.com/downloads">Git</a> installed.</li>
	<li>Operating system: macOS or Linux</li>
	<li>Architecture: x86_64</li>
	<li><b>Minimum 6GB</b> memory dedicated to Docker (the default is 2GB on Macs).</li>
</ul>
This guide is tested with Docker for Mac, Community Edition-18.06.1-ce-mac73 (26764) and
<em>vespaengine/vespa</em> Docker image built 2018-10-01.
</p>

<h2>Running Vespa in Docker</h2>
<ol>
<li>
    <p><strong>Validate environment:</strong></p>
<pre>
$ docker info | grep "Total Memory"
</pre>
<p>
    Make sure you see something like <em>Total Memory: 5.818GiB</em>
</p>
</li>

<li>
    <p><strong>Clone the Vespa sample apps from
    <a href="https://github.com/vespa-engine/sample-apps">github</a>:</strong></p>
<pre data-test="exec">
$ git clone https://github.com/vespa-engine/sample-apps.git
$ export VESPA_SAMPLE_APPS=`pwd`/sample-apps
</pre>
</li>

<li>
    <p><strong>Start a Vespa Docker container:</strong></p>
<pre data-test="exec">
$ docker run --detach --name vespa --hostname vespa-container --privileged \
  --volume $VESPA_SAMPLE_APPS:/vespa-sample-apps --publish 8080:8080 vespaengine/vespa
</pre>
<p>
    The <samp>volume</samp> option makes the previously downloaded source code available
    as <samp>/vespa-sample-apps</samp> inside the docker container.
    The port <samp>8080</samp> is published to make the search and feed interfaces
    accessible outside of the docker container.
    Only one docker container named <samp>vespa</samp> can run at a time so change the name if needed.
</p>
<p>
    If you're interested in the exact steps performed by the above command, please see the
    <a href="https://github.com/vespa-engine/docker-image/blob/master/Dockerfile">Dockerfile</a> and
    the <a href="https://github.com/vespa-engine/docker-image/blob/master/include/start-container.sh">startup script</a>.
</p>
</li>

<li>
    <p><strong>Wait for the configuration server to start - signified by a 200 OK response:</strong></p>
<pre data-test="exec" data-test-wait-for="200 OK">
$ docker exec vespa bash -c 'curl -s --head http://localhost:19071/ApplicationStatus'
</pre>
</li>

<li>
    <p><strong>Deploy and activate a sample application:</strong></p>
<pre data-test="exec">
$ docker exec vespa bash -c '/opt/vespa/bin/vespa-deploy prepare \
  /vespa-sample-apps/album-recommendation-selfhosted/src/main/application/ &amp;&amp; \
  /opt/vespa/bin/vespa-deploy activate'
</pre>
    <p>More sample applications can be found in
    <a href="https://github.com/vespa-engine/sample-apps/tree/master">sample-apps</a>.
    Read more on applications in
    <a href="cloudconfig/application-packages.html">Application packages</a>.</p>
</li>

<li>
    <p><strong>Ensure the application is active - wait for a 200 OK response:</strong></p>
<pre data-test="exec" data-test-wait-for="200 OK">
$ curl -s --head http://localhost:8080/ApplicationStatus
</pre>
</li>

<li>
    <p><strong>Feed documents:</strong></p>
<pre data-test="exec">
$ curl -H "Content-Type:application/json" --data-binary @${VESPA_SAMPLE_APPS}/album-recommendation-selfhosted/src/test/resources/A-Head-Full-of-Dreams.json \
  http://localhost:8080/document/v1/mynamespace/music/docid/1
$ curl -H "Content-Type:application/json" --data-binary @${VESPA_SAMPLE_APPS}/album-recommendation-selfhosted/src/test/resources/Love-Is-Here-To-Stay.json \
  http://localhost:8080/document/v1/mynamespace/music/docid/2
$ curl -H "Content-Type:application/json" --data-binary @${VESPA_SAMPLE_APPS}/album-recommendation-selfhosted/src/test/resources/Hardwired...To-Self-Destruct.json \
  http://localhost:8080/document/v1/mynamespace/music/docid/3
</pre>
    <p>This uses <a href="reference/document-v1-api-reference.html">/document/v1/</a> -
    use <a href="vespa-http-client.html">vespa-http-client</a> to feed large amounts of data, fast.</p>
</li>

<li>
    <p><strong>Make a query:</strong></p>
<pre data-test="exec" data-test-assert-contains="Metallica">
$ curl "http://localhost:8080/search/?ranking=rank_albums&amp;yql=select%20%2A%20from%20sources%20%2A%20where%20sddocname%20contains%20%22music%22%3B&amp;ranking.features.query(user_profile)=%7B%7Bcat%3Apop%7D%3A0.8%2C%7Bcat%3Arock%7D%3A0.2%2C%7Bcat%3Ajazz%7D%3A0.1%7D"
</pre>
    <p>
    You can also view query results in a browser with the query builder UI at
    <a href="http://localhost:8080/querybuilder/">http://localhost:8080/querybuilder/</a>.
    The query builder has guided queries and YQL autocompletion.
    Read more in the <a href="query-api.html">Query API</a>.
    </p>
</li>

<li>
    <p><strong>Run a document GET request:</strong></p>
<pre data-test="exec" data-test-assert-contains="Diana">
$ curl -s http://localhost:8080/document/v1/mynamespace/music/docid/2
</pre>
</li>
</ol>

<h3>Visualising data from Vespa</h3>
<p>You have now successfully started Vespa and deployed and activated an application. The next few steps show you
how you can effectively integrate Vespa with visualisation software such as Grafana. If you don't wish to do this,
you can simply clean up by running <pre data-test="after"> $ docker rm -f vespa</pre> The following guide
requires that docker-compose is installed on your system as well as docker.</p>
<ol>
<li>
    <p><strong>Create a new network and add Vespa to it</strong></p>
</li>
<pre data-test="exec">
$ cd sample-apps
$ docker network create --driver bridge sample-apps_backend
$ docker network connect sample-apps_backend vespa
</pre>
    <p>
    This creates a new network called sample-apps_backend and attaches our vespa container to it. The naming is
    important, as we will be launching the rest of our applications using the docker-compose.yml file, that relies
    on the network being named sample-apps_backend.
    </p>

<li>
    <p><strong>Launch Prometheus and Grafana</strong></p>
</li>
<pre data-test="exec">
$ docker-compose up --detach prometheus
$ docker-compose up --detach grafana
</pre>
    <p>
    This launches Prometheus and Grafana with configurations defined in the docker-compose.yml file. Prometheus is a
    time-series database, which holds a series of values associated with a timestamp. Grafana is a visualisation tool
    that can be used to easily make representations of important metrics surrounding Vespa. Our configuration for both
    of these include some default values and connects the two of them together
    </p>

<li>
    <p><strong>Check that Grafana and Prometheus are running</strong></p>
</li>
    <p>
    Open up your favorite web browser and visit http://localhost:3000. You should be greeted with the Grafana login
    screen. Log in with admin:admin as username:password and then skip changing password. From the list on the left
    click Manage under Dashboards (the symbol with 4 blocks). Then click the Vespa Engine Metric Dashboard. <br>
    This dashboard has a selected few metrics relevant to the Vespa engine. Right now it will be empty, but soon we
    will fill it with data. Now let us look at Prometheus <br>
    In a new tab, go to http://localhost:9090. Here Prometheus is available. You can easily look at what data prometheus
    has and check to see the status of the data sources it wants to access.
    </p>

<li>
    <p><strong>Start the Random Data Feeder</strong></p>
</li>
<pre data-text="exec">
$ docker-compose up --detach random-data-feeder
</pre>

    <p>
    This will compile and start a Random Data Feeder. The Random Data Feeder generates random sets of data and puts
    them into the Vespa instance. In addition it repeatedly runs queries, ensuring that we get nice and useful data
    for the Grafana visualisation. Compiling the Random Data Feeder will take around 4 minutes, so be patient.
    </p>

<li>
    <p><strong>Check the updated Grafana metrics</strong></p>
</li>
    <p>
    Go back to your Grafana tab on your favorite browser. If you refresh the page you should now see data starting to
    appear. It might take a minute or two. If you just leave the docker containers running you will slowly get more
    data. <br>
    The Grafana dashboard is fully customisable and can be changed to your liking. It is also possible to change how
    the default mode of Grafana and Prometheus operate by editing the configuration files that are available under
    album-recommendation-monitoring folder.
    </p>

<li>
    <p><strong>Clean up:</strong></p>
</li>
<pre data-text="exec">
$ docker-compose down --rmi all
$ docker rm -f vespa
</pre>
</ol>




<h2 id="troubleshooting">Troubleshooting</h2>
<p>
See <a href="vespa-quick-start-troubleshooting.html">troubleshooting</a>.
For json pretty-print, append
<pre>
| python -m json.tool
</pre>
to commands that output json.
</p>



<h2 id="next-steps">Next Steps</h2>
<ul>
  <li>
    This application is fully functional and production ready, but you may want to
    <a href="multinode-systems.html">add more nodes</a> for redundancy.
  </li><li>
    Try the <a href="tutorials/blog-search.html">Blog search and recommendation tutorial</a>
    to learn more about using Vespa
  </li><li>
    See <a href="getting-started-vespa-applications.html">Vespa Applications</a>
    on adding your own Java components to your Vespa application.
  </li><li>
    <a href="api.html">Vespa APIs</a> is useful to understand how to interface with Vespa
  </li><li>
    Explore the <a href="https://github.com/vespa-engine/sample-apps/tree/master">
      sample applications</a>
  </li><li>
    How to <a href="securing-your-vespa-installation.html">secure a Vespa installation</a>
  </li><li>
    To run on AWS, see the <a href="vespa-quick-start-multinode-aws.html">AWS EC2 multinode quick start</a>
    or <a href="vespa-quick-start-multinode-aws-ecs.html">AWS ECS multinode quick start</a>
  </li><li>
    To run on Docker Swarm, see
    <a href="https://github.com/vespa-engine/sample-apps/tree/master/basic-search-on-docker-swarm">basic-search-on-docker-swarm</a>.
  </li>
</ul>
