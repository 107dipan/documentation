---
# Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "File distribution"
---

<p>
An <a href="../reference/application-packages-reference.html">application package</a>
might have components and other large files that should be distributed to the Vespa nodes.
Vespa can distribute these files efficiently to the nodes at the time of deploying an
application (when doing <em>vespa-deploy prepare</em>).
</p>

<h2>Files</h2>
<p>
Which files are distributed?
</p>
<ul>
  <li>Components</li>
  <li>Files with type <em>path</em> in config, see
      <a href="../configuring-components.html#adding-files-to-the-component-configuration">Adding Files to the Component Configuration</a></li>
  <li><a href="../reference/search-definitions-reference.html#constant">Constant tensors</a></li>
</ul>

<p>
Distributed files are put in <em>$VESPA_HOME/var/db/vespa/filedistribution</em> on the nodes
</p>

<p>
When new components or files specified in config are distributed, the container gets a new file reference,
waits for it to be available and switches to new config when all files are available.
</p>


<h2 id="troubleshooting">Troubleshooting</h2>
<p>
<em>vespa-status-filedistribution</em> can be run to
check if files have been distributed to all the hosts.
</p>
<p>
The following scenario has occasionally been overserved:
Clients nodes (such as containers) request components from file distribution at reconfiguration,
but the files are never delivered, such that a timeout occur and the node fail to reconfigure.
Log messages starting by <em>Could not install bundle</em>
followed by timeout information is found in the logs.
This can be caused by too many file references (many historical versions of files)
in the file distribution subsystem which for some reason have not been cleaned up - clean up manually:
<pre>
$ zkctl rmr /vespa/filedistribution
$ rm $VESPA_HOME/var/db/vespa/filedistribution/*
</pre>
The first command can be run on any config server node while config servers are running.
The second should be run on all config server nodes.
</p>
