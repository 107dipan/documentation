---
# Copyright 2018 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "Vespa 7 Release Notes"
---

<p>This document documents the changes between Vespa major versions 6 and 7.
  As documented in <a href="vespa-versions.html">Vespa versions</a>, major versions are used to mark breaking compatibility,
  not to release significant new functionality (which instead happens on minor versions).
  However even on major versions, compatibility is broken only in two specific ways: <b>Changes to defaults</b> means that
  applications may need to set some option explicitly to preserve earlier behavior, and <b>removal of deprecated functionality</b>
  means that applications <i>which use functionality that has earlier been deprecated</i> need to change to keep working.</p>

<p>Most deprecated functionality causes warning during compilation (Java API deprecations) or deployment
  (application package deprecations), however with web service API's there is no way to emit deprecation warnings,
  and we have to rely on marking these as deprecated in the documentation.</p>

<p>Given this, application owners need to do 3 tasks to be compatible with Vespa 7:
  <ul>
    <li>Review whether <a href="#changed-defaults">changes to defaults</a> requires additional settings in the application
      (<b>note that this is likely</b> on changing from 6 to 7 due to the changes to tokenization and stemming).
    <li>Make sure there are no deprecation warnings on compilation and deployment on Vespa 6.
    <li>Review the list of removed web service API's and API parameters and make sure these are not used by clients of
      the application.
  </ul>
</p>

<p>As Vespa 7 does not introduce new functionality, it is as safe and mature as the versions of Vespa 6 preceding it.
  Upon release of Vespa 7, no further releases will be made of Vespa 6 for any reason.</p>



<h2 id="changes">Changes</h2>

<p>The following sections lists the changes on moving from Vespa 6 to Vespa 7 which must be reviewed by applications.</p>


<h3 id="changed-defaults">Changed defaults</h3>

<p>The following defaults have changed:</p>

<table width="100%" class="table">
  <thead>
  <tr>
    <th width="50%">Change</th><th>Configuration required to avoid change on Vespa 7</th>
  </tr>
  </thead>
  <tbody>

  <tr>
    <!-- TODO -->
    <td><code>stemming: shortest</code> changed to <code>stemming: best</code></td>
    <td>Add <code><a href="reference/search-definitions-reference.html#stemming">stemming: shortest</a></code>
      to the document block of all search definitions.</td>
  </tr>

  <tr>
    <!-- TODO -->
    <td>Default linguistics component changed from SimpleLinguistics to OpenNlpLinguistics,
    including language detection using Optimaize turned on by default.</td>
    <td>Configure <code>com.yahoo.language.simple.SimpleLinguistics</code> as a component in services.xml as described in
      <a href="linguistics.html">linguistics in Vespa</a>
    </td>
  </tr>

  <tr>
    <td>The default format accepted by the <a href="vespa-http-client.html">Java HTTP client</a>
      is changed from XML to <a href="reference/document-json-format.html">JSON</a></td>
    <td>To keep using XML:
      <ul>
        <li><b>Java API</b>: When calling <code>FeedClientFactory.create(sessionParams, ...)</code>, pass a <code>SessionParams</code>
          instance which has a <code>FeedParams</code> instance which have <code>dataFormat</code> set to
          <code>FeedParams.DataFormat.XML_UTF8</code>
        <li><b>Command line</b>: Pass the <code>--xmloutput</code> option.
    </td>
  </tr>

  <tr>
    <!-- TODO -->
    <td>The default access log format is changed to <a href="logging-in-json-format.html">JSON</a>.</td>
    <td>To keep the old proprietary format, set accesslog type=vespa in services.xml
      as described in <a href="reference/services-container.html#accesslog">the accesslog reference</a>.
  </tr>
  </tbody>
</table>


<h3 id="jdk-version">JDK version</h3>

<p>Java components must be rebuilt with JDK 11 for the Vespa bundle-plugin to generate the
correct set of imported packages for your OSGi bundles.</p>


<h3 id="removed-java-apis">Removed Java API's</h3>

<!-- TODO -->
<p>Classes and methods that were marked as deprecated in Vespa 6 are removed.
If you get deprecation warnings for Vespa API's when building your
 application, they must be fixed before migrating to Vespa 7.</p>



<h3 id="removed-http-apis">Removed HTTP API's</h3>

<p>The following HTTP API's are removed:</p>

<table width="100%" class="table">
  <thead>
    <tr>
      <th width="50%">Name</th><th>Replacement</th>
    </tr>
  </thead>
  <tbody>

    <tr>
      <td>Legacy HTTP apis for document feeding:
        <ul>
          <li>/feed</li> <!-- TODO -->
          <li>/remove</li> <!-- TODO -->
          <li>/removelocation</li> <!-- TODO -->
          <li>/get</li> <!-- TODO -->
          <li>/visit</li> <!-- TODO -->
          <li>/document</li> <!-- TODO -->
        </ul>
      </td>
      <td>
        The <a href="document-api.html">/document/v1</a> web service API,
        or (for high throughput) the <a href="vespa-http-client.html">Java HTTP client</a>
      </td>
    </tr>
  </tbody>
</table>



<h3 id="removed-http-api-parameters">Removed HTTP API parameters</h3>

<p>The following HTTP API parameters are removed</p>

<table width="100%" class="table">
  <thead>
  <tr>
    <th width="50%">Name</th><th>Replacement</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>The <code>defidx</code> parameter in the search API</td>
    <td>Use a custom searcher if this functionality is needed.</td>
  </tr>
  </tbody>
</table>


<h3 id="removed-command-line-tools">Removed command line tools</h3>

<p>The following command line tools are removed:</p>

<table width="100%" class="table">
  <thead>
  <tr>
    <th width="50%">Name</th><th>Replacement</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>Vespa spooler</td>
    <td>Custom client using the <a href="vespa-http-client.html">Java HTTP client</a></td>
  </tr>
  </tbody>
</table>



<h3 id="removed-constructs-from-services-xml">Removed constructs from services.xml</h3>

<p>The following tags and attributes are removed from services.xml:</p>

<table width="100%" class="table">
  <thead>
    <tr>
      <th width="50%">Name</th><th>Replacement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>‘rotationScheme’ attribute in &lt;container&gt;&lt;accesslog&gt;</td>
      <td>None, rotation scheme ‘date’ will always be used</td>
    </tr>
    <tr>
      <td>&lt;container&gt;&lt;filter&gt; tag</td>
      <td>&lt;container&gt;&lt;http&gt;&lt;filtering&gt;</td>
    </tr>
  </tbody>
</table>



<h3 id="removed-metrics">Removed metrics</h3>

<p>The following metrics are removed:</p>

<table width="100%" class="table">
  <thead>
    <tr>
      <th width="50%">Name</th><th>Replacement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>free/used/totalMemoryBytes</td>
      <td>mem.heap.free/used/total</td>
    </tr>
    <tr>
      <td>http.in.bytes</td>
      <td>serverBytesReceived</td>
    </tr>
    <tr>
      <td>http.out.bytes</td>
      <td>serverBytesSent</td>
    </tr>
    <tr>
      <td>http.requests</td>
      <td>serverNumRequests</td>
    </tr>
    <tr>
      <td>http.latency</td>
      <td>serverTotalSuccessfulResponseLatency</td>
    </tr>
    <tr>
      <td>http.out.firstbytetime</td>
      <td>serverTimeToFirstByte</td>
    </tr>
    <tr>
      <td>proc.uptime</td>
      <td>serverStartedMillis</td>
    </tr>
    <tr>
      <td>proton.*</td>
      <td>content.proton.* (note that metrics might have different structure and names in new namespace)</td>
    </tr>
    <tr>
      <td>vds.filestor.spi.*</td>
      <td>vds.filestor.alldisks.allthreads.*</td>
    </tr>
  </tbody>
</table>



